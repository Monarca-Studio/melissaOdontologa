---
import { Image } from "astro:assets";
import { carrouselImages } from "~/content/generalDataInformation";
---

<section>
  <!-- Horizontal Carousel with Arrows and Auto-scroll -->
  <div class="relative mx-5 md:mx-20 mt-12 overflow-hidden">
    <!-- Left Arrow -->
    <button class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-gold text-white p-2 rounded-full z-10 hover:bg-yellow-500 transition" id="prev">
      &#10094;
    </button>

    <!-- Carousel Items -->
    <div class="flex transition-transform duration-700 ease-out gap-20" id="carousel-container" data-images-count={carrouselImages.length}>
      <!-- Cloned Last Item (For Infinite Scroll) -->
      <div class="relative group flex-shrink-0 w-[300px]">
        <Image class="w-full h-full object-cover rounded-md shadow-lg transform scale-100 group-hover:scale-105 transition-transform duration-500" 
          src={carrouselImages[carrouselImages.length - 1].image} alt={carrouselImages[carrouselImages.length - 1].alt} />
      </div>
      <!-- Carousel Images -->
      {
        carrouselImages.map((item) => (
          <div class="relative group flex-shrink-0 w-[300px]">
            <Image class="w-full h-full object-cover rounded-md shadow-lg transform scale-100 group-hover:scale-105 transition-transform duration-500" 
              src={item.image} alt={item.alt} />
          </div>
        ))
      }
      <!-- Cloned First Item (For Infinite Scroll) -->
      <div class="relative group flex-shrink-0 w-[300px]">
        <Image class="w-full h-full object-cover rounded-md shadow-lg transform scale-100 group-hover:scale-105 transition-transform duration-500" 
          src={carrouselImages[0].image} alt={carrouselImages[0].alt} />
      </div>
    </div>

    <!-- Right Arrow -->
    <button class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-gold text-white p-2 rounded-full z-10 hover:bg-yellow-500 transition" id="next">
      &#10095;
    </button>
  </div>
</section>

<script>
  const container = document.getElementById('carousel-container');
  const imagesCount = parseInt(container.dataset.imagesCount, 10); // Número de imágenes
  const itemWidth = 300; // Anchura de cada imagen
  let currentIndex = 1; // Comenzamos en la primera imagen real (después del clonado)

  // Posicionamos el carrusel en el primer item real (no el clonado)
  container.style.transform = `translateX(${-itemWidth * currentIndex}px)`;

  // Función para desplazarse al siguiente item
  function scrollToNext() {
    currentIndex++;
    container.style.transition = 'transform 0.7s ease-out';
    container.style.transform = `translateX(${-itemWidth * currentIndex}px)`;

    // Cuando llegamos al final, sin que el usuario lo perciba, saltamos al primer item real
    if (currentIndex === imagesCount + 1) {
      setTimeout(() => {
        container.style.transition = 'none'; // Eliminamos la transición temporalmente
        currentIndex = 1; // Volvemos al primer item real
        container.style.transform = `translateX(${-itemWidth * currentIndex}px)`;
      }, 10000); // Esperamos que termine la animación de desplazamiento
    }
  }

  // Función para desplazarse al item anterior
  function scrollToPrev() {
    currentIndex--;
    container.style.transition = 'transform 0.7s ease-out';
    container.style.transform = `translateX(${-itemWidth * currentIndex}px)`;

    // Cuando llegamos al principio, sin que el usuario lo perciba, saltamos al último item real
    if (currentIndex === 0) {
      setTimeout(() => {
        container.style.transition = 'none'; // Eliminamos la transición temporalmente
        currentIndex = imagesCount; // Volvemos al último item real
        container.style.transform = `translateX(${-itemWidth * currentIndex}px)`;
      }, 10000); // Esperamos que termine la animación de desplazamiento
    }
  }

  // Auto-scroll cada 5 segundos
  setInterval(() => {
    scrollToNext();
  }, 10000);

  // Controladores de los botones de flechas
  document.getElementById('prev').addEventListener('click', scrollToPrev);
  document.getElementById('next').addEventListener('click', scrollToNext);
</script>